<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">

    <changeSet id="cfl-visits-1" author="Daniel Serkowski">
        <preConditions>
            <tableExists tableName="global_property"/>
        </preConditions>

        <comment>Resets visits.visit-form-uris to the default value (the property structure and its description
            have been changed). It is in order to apply the new changes to all already existing environments. The
            migration can be removed if the liquibase refactor will be conducted (eg. replacing all changes by one
            changeSet).</comment>

        <delete tableName="global_property">
            <where>property='visits.visit-form-uris'</where>
        </delete>
    </changeSet>

    <changeSet id="cfl-visits-2" author="PaweÅ‚ Cieszko">
        <preConditions>
            <tableExists tableName="global_property"/>
        </preConditions>

        <comment>Resets visits.visit-form-uris to the default value (the property structure and its description
            have been changed). It is in order to apply the new changes to all already existing environments. The
            migration can be removed if the liquibase refactor will be conducted (eg. replacing all changes by one
            changeSet).</comment>

        <delete tableName="global_property">
            <where>property='visits.visit-form-uris'</where>
        </delete>
    </changeSet>

    <changeSet id="cfl-visits-3" author="Dawid Ruchniewicz">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="global_property"/>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM global_property WHERE property = 'visits.isMissedVisitChangerShouldBeCreated'
            </sqlCheck>
        </preConditions>
        <comment>Adds visits.isMissedVisitChangerShouldBeCreated global property </comment>
        <sql><![CDATA[
            INSERT INTO global_property (
                        property,
                        property_value,
                        description,
                        uuid)
            VALUES (    'visits.isMissedVisitChangerShouldBeCreated',
                        'false',
                        'Used to determine if Missed Visits Status Changer task should be created during module startup.
                        Changes will be applied the next time the module is restarted. If task already exists
                        and GP value is false it will not remove task during next server restart - it has to be removed
                        manually. Possible values: true, false',
                        uuid()
            );
        ]]>
        </sql>
    </changeSet>
</databaseChangeLog>
